@using Manager.WebApp.Resources
@using Manager.WebApp.Models
@using Manager.SharedLibs
@using Manager.WebApp.Caching

@model Manager.WebApp.Models.CompanyEditModel

@{
    var title = ManagerResource.LB_COMPANY_DETAIL;
    ViewBag.Title = title;
    ViewBag.HideSubHeader = true;
}
@Html.Partial("../Widgets/Modals/_LargeModal")
<div class="m-portlet m-portlet--full-height m-portlet--tabs">
    <div class="m-portlet__head">
        <div class="m-portlet__head-tools">
            <ul class="nav nav-tabs m-tabs m-tabs-line   m-tabs-line--left m-tabs-line--primary" role="tablist">
                <li class="nav-item m-tabs__item">
                    <a class="nav-link m-tabs__link active" data-toggle="tab" href="#m_user_profile_tab_1" role="tab">
                        <i class="fa fa-building"></i>
                        @ManagerResource.LB_COMPANY_DETAIL
                    </a>
                </li>
                <li class="nav-item m-tabs__item">
                    <a class="nav-link m-tabs__link JobListTab" data-toggle="tab" href="#m_user_profile_tab_2" role="tab">
                        <i class="fa fa-file-word-o"></i>
                        @ManagerResource.LB_JOB
                    </a>
                </li>
                <li class="nav-item m-tabs__item">
                    <a class="nav-link m-tabs__link RecruitedListTab" data-toggle="tab" href="#m_user_profile_tab_3" role="tab">
                        <i class="fa fa-file-word-o"></i>
                        @ManagerResource.LB_CANDIDATE_RECRUITED
                    </a>
                </li>
                <li class="nav-item m-tabs__item">
                    <a class="nav-link m-tabs__link MailBoxTab" data-toggle="tab" href="#CompanyEmailHistories" role="tab">
                        <i class="fa fa-envelope"></i>
                        @ManagerResource.LB_EMAIL
                    </a>
                </li>
            </ul>
        </div>
    </div>
    <div class="tab-content tab-content-custom">
        <div class="tab-pane active" id="m_user_profile_tab_1">
            <div class="m-form m-form--fit m-form--label-align-left">
                <div class="m-portlet__body">
                    <div class="m-widget13 detail-content">
                        @RenderBaseForm()
                    </div>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="m_user_profile_tab_2">
            <div class="m-form m-form--fit m-form--label-align-right">
                <div class="m-portlet__body">
                    <form id="JobListFrm">
                        <input type="hidden" value="1" id="CurrentJobListTabPageIdx" name="CurrentJobListTabPageIdx" />
                        @Html.HiddenFor(m => m.id)
                        <input type="hidden" value="@((int)EnumJobStatus.Published)" name="Status" />
                        <div class="m-widget1 nopadding" id="JobListTab">
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <div class="tab-pane" id="m_user_profile_tab_3">
            <div class="m-form m-form--fit m-form--label-align-right">
                <div class="m-portlet__body">
                    @using (Html.BeginForm("Recruited", "Candidate", FormMethod.Post, new { role = "form", @class = "", id = "frmRecruited" }))
                    {
                        <input type="hidden" value="@Model.id" name="company_id" />
                        <input type="hidden" value="1" name="CurrentPage" />
                        <div class="m-widget1 nopadding" id="RecruitedListTab">
                        </div>
                    }
                </div>
            </div>
        </div>

        <div class="tab-pane" id="CompanyEmailHistories">
            <form id="MailBoxFrm">
                <div class="m-form m-form--fit">
                    <div class="m-portlet__body">
                        <input type="hidden" value="1" id="CurrentMailBoxPageIdx" name="CurrentMailBoxPageIdx" />
                        <input type="hidden" value="1" id="is_online" name="is_online" />
                        <input type="hidden" value="@Model.id" name="company_id" />
                        <div class="m-widget1 nopadding" id="MailBoxHistories">
                        </div>
                    </div>
                </div>
            </form>
        </div>
        @*<div class="pb-3">
                <div class="col-lg-12 col-md-12 col-sm-12">
                    <a class="btn btn-outline-info btn-back" href="@Url.Action("Index", "Company")"><i class="fa fa-backward"></i> @ManagerResource.LB_GOBACK</a>
                </div>
            </div>*@
    </div>
    <div class="m-portlet__foot">
        <div class="col-lg-12 col-md-12 col-sm-12 form-group pt-3">
            <a class="btn btn-outline-info btn-back btn-sm" href="@Url.Action("Index", "Company")"><i class="fa fa-backward"></i> @ManagerResource.LB_GOBACK</a>
            @if (PermissionHelper.CheckPermission("Edit", "Job"))
            {
                if (PermissionHelper.CheckIsPic(Model.pic_id))
                {
                    var editLink = SecurityHelper.GenerateSecureLink("Company", "Edit", new { Id = Model.id });
                    <a class="btn btn-warning btn-sm" href="@editLink"> <i class="la la-pencil"></i>&nbsp;@ManagerResource.LB_EDIT</a>
                }
                else
                {
                    <a class="btn btn-warning btn-sm btn-error-incorrect-user" href="javascript:;"> <i class="la la-pencil"></i>&nbsp;@ManagerResource.LB_EDIT</a>
                }
            }
        </div>
    </div>
</div>

@section PageInlineStyles{
    <link href="~/Content/Extensions/fancybox/jquery.fancybox.min.css" rel="stylesheet" />
}

@helper RenderBaseForm()
{
    var currentLang = UserCookieManager.GetCurrentLanguageOrDefault();
    <div class="row">
        <div class="col-md-3 col-responsive-left">
            <div class="form-group">
                <div class="upload-portfolio mt10 mb10">
                    <div class="uploadbox mt5" id="uploadbox">
                        <img class="file-upload-btn thumbImg img-full-center @((string.IsNullOrEmpty(Model.logo_full_path)) ? "hidden" : string.Empty)" src="@Model.logo_full_path" />
                        <label for="file-upload" class="custom-file-upload file-upload-icon @((!string.IsNullOrEmpty(Model.logo_full_path)) ? "hidden" : string.Empty)">
                            <i class="la la-cloud-upload"></i> <span>@ManagerResource.LB_UPLOAD_IMAGE</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-9 col-responsive-right pr0">
            <fieldset class="mb20 pt0 pb20">
                <legend class="legend-ctrl">
                    @ManagerResource.LB_JOBSEEKER_BASIC_INFORMATION <i class="fa fa-angle-up"></i>
                </legend>
                <div class="fieldset-content">
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_COMPANY_NAME
                        </div>
                        <div class="col-md-9 company-name">
                            @if (!string.IsNullOrEmpty(Model.website))
                            {
                                <a href="@Model.website" target="_blank">  @Model.company_name</a>
                            }
                            else
                            {
                                @Model.company_name
                            }
                        </div>
                    </div>
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_COMPANY_SIZE
                        </div>
                        <div class="col-md-9 info-text">
                            @if (Model.CompanySizes.HasData())
                            {
                                foreach (var item in Model.CompanySizes)
                                {
                                    if (item.id == Model.company_size_id)
                                    {
                                        @(item.size + " " + @ManagerResource.LB_EMPLOYEES)
                                    }
                                }
                            }
                        </div>
                    </div>
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_ESTABLISHED_YEAR
                        </div>
                        <div class="col-md-9 info-text">
                            @Model.establish_year
                        </div>
                    </div>
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_INDUSTRY_LABEL
                        </div>
                        <div class="col-md-9 info-text">
                            @if (Model.Industries.HasData())
                            {
                                foreach (var industry in Model.Industries)
                                {
                                    if (industry.Sub_industries.HasData())
                                    {
                                        foreach (var sub in industry.Sub_industries)
                                        {
                                            if (sub.id == Model.sub_industry_id)
                                            {
                                                var subName = sub.LangList.Where(x => x.language_code == currentLang).Select(x => x.sub_industry).FirstOrDefault();
                                                if (string.IsNullOrEmpty(subName))
                                                {
                                                    subName = sub.sub_industry;
                                                }
                                                @subName
                                            }
                                        }
                                    }
                                }
                            }
                        </div>
                    </div>
                    @if (!string.IsNullOrEmpty(Model.email))
                    {
                        <div class="row info-item">
                            <div class="col-md-3 info-label">
                                @ManagerResource.LB_EMAIL
                            </div>
                            <div class="col-md-9 info-text">
                                @Model.email
                            </div>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.phone))
                    {
                        <div class="row info-item">
                            <div class="col-md-3 info-label">
                                @ManagerResource.LB_PHONE
                            </div>
                            <div class="col-md-9 info-text">
                                @Model.phone
                            </div>
                        </div>
                    }

                    @if (!string.IsNullOrEmpty(Model.fax))
                    {
                        <div class="row info-item">
                            <div class="col-md-3 info-label">
                                @ManagerResource.LB_FAX
                            </div>
                            <div class="col-md-9 info-text">
                                @Model.fax
                            </div>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.address_full))
                    {
                        <div class="row info-item">
                            <div class="col-md-3 info-label">
                                @ManagerResource.LB_ADDRESS
                            </div>
                            <div class="col-md-9 info-text">
                                @FrontendHelpers.SubstringBracket(Model.address_full)
                            </div>
                        </div>
                    }
                    @if (!string.IsNullOrEmpty(Model.description))
                    {
                        <div class="row info-item">
                            <div class="col-md-3 info-label">
                                @ManagerResource.LB_DESCRIPTION
                            </div>
                            <div class="col-md-9 info-text">
                                @Model.description
                            </div>
                        </div>
                    }
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_PERSON_CHARGE
                        </div>
                        <div class="col-md-9 info-text">
                            @RenderUser(Model.pic_id)
                        </div>
                    </div>
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_CREATE_PERSON
                        </div>
                        <div class="col-md-9 info-text">
                            @RenderUser(Model.staff_id)
                        </div>
                    </div>
                    <div class="row info-item">
                        <div class="col-md-3 info-label">
                            @ManagerResource.LB_CREATED_DATE
                        </div>
                        <div class="col-md-9 info-text">
                            @Model.created_at.DateTimeQuestToLocaleString(currentLang)
                        </div>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
    @*<div class="row">
        <div class="col-lg-3 col-sm-12" title="@ManagerResource.LB_COVER_IMAGE">
            <div class="form-group">
                <div class="upload-portfolio mb10">
                    <div class="uploadbox" id="uploadbox">
                        <img class="file-upload-btn thumbImg img-full-center @((string.IsNullOrEmpty(Model.logo_full_path)) ? "hidden" : string.Empty)" src="@Model.logo_full_path" />
                        <label for="file-upload" class="custom-file-upload file-upload-icon @((!string.IsNullOrEmpty(Model.logo_full_path)) ? "hidden" : string.Empty)">
                            <i class="la la-cloud-upload"></i> <span>@ManagerResource.LB_UPLOAD_IMAGE</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-9 col-sm-12">
            <div class="col-lg-12 row content-title">
                @if (!string.IsNullOrEmpty(Model.website))
                {
                    <a href="@Model.website" target="_blank">  @Model.company_name</a>
                }
                else
                {
                    @Model.company_name
                }
            </div>
            <div class="row">
                <div class="col-lg-4 col-sm-12">
                    <label class="">
                        @ManagerResource.LB_COMPANY_SIZE:
                    </label>
                    @if (Model.CompanySizes.HasData())
                    {
                        foreach (var item in Model.CompanySizes)
                        {
                            if (item.id == Model.company_size_id)
                            {
                                @(item.size + " " + @ManagerResource.LB_EMPLOYEES)
                            }
                        }
                    }
                </div>
                <div class="col-lg-4 col-sm-12">
                    <label class="">
                        @ManagerResource.LB_ESTABLISHED_YEAR:
                    </label>

                    @Model.establish_year
                </div>
                <div class="col-lg-4 col-sm-12">
                    <label>@ManagerResource.LB_INDUSTRY_LABEL:</label>
                    @if (Model.Industries.HasData())
                    {
                        foreach (var industry in Model.Industries)
                        {
                            if (industry.Sub_industries.HasData())
                            {
                                foreach (var sub in industry.Sub_industries)
                                {
                                    if (sub.id == Model.sub_industry_id)
                                    {
                                        var subName = sub.LangList.Where(x => x.language_code == currentLang).Select(x => x.sub_industry).FirstOrDefault();
                                        if (string.IsNullOrEmpty(subName))
                                        {
                                            subName = sub.sub_industry;
                                        }
                                        @subName
                                    }
                                }
                            }
                        }
                    }
                </div>
            </div>

            <div class="row">
                @if (!string.IsNullOrEmpty(Model.email))
                {
                    <div class="col-md-4">
                        <i class="fa fa-envelope-o text-danger" aria-hidden="true"></i>  @Model.email
                    </div>
                }
                @if (!string.IsNullOrEmpty(Model.phone))
                {
                    <div class="col-md-4">
                        <i class="fa fa-phone text-success" aria-hidden="true"></i>  @Model.phone
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.fax))
                {
                    <div class="col-md-4">
                        <i class="fa fa-fax" aria-hidden="true"></i>  @Model.fax
                    </div>
                }
            </div>

            @if (!string.IsNullOrEmpty(Model.address_full))
            {
                <div class="row">
                    <div class="col-lg-12 col-sm-12">
                        <i class="fa fa-map-marker text-danger" aria-hidden="true"></i>&nbsp;<label class="">
                            @ManagerResource.LB_ADDRESS:
                        </label>
                        @FrontendHelpers.SubstringBracket(Model.address_full)
                    </div>
                </div>
            }
        </div>
    </div>
    if (!string.IsNullOrEmpty(Model.description))
    {
        <div class="col-lg-12 col-sm-12 content-description form-group">
            <div class="col-md-12">

            </div>
            @Html.RawHtmlCustom(Model.description)
        </div>
    }
    <div class="row">
        <div class="col-md-3">
            <label class="text-bold">
                @ManagerResource.LB_PERSON_CHARGE:
            </label>
            @RenderUser(Model.pic_id)
        </div>
        <div class="col-md-3">
            <label>@ManagerResource.LB_CREATE_PERSON:</label>
            @RenderUser(Model.staff_id)
        </div>
        <div class="col-md-3">
            <label>@ManagerResource.LB_CREATED_DATE:</label>
            @Model.created_at.DateTimeQuestToLocaleString(currentLang)
        </div>
    </div>*@
}
@helper RenderUser(int userId)
{
    var ListUser = CommonHelpers.GetListUser(Model.agency_id);
    if (ListUser != null && ListUser.Count > 0)
    {
        foreach (var item in ListUser)
        {
            if (item.StaffId == Model.pic_id)
            {
                @item.FullName;
                break;
            }
        }
    }
}
@section PagePluginStyles
{
    <link href="@Url.VersionedContent("~/Content/Page/Company/main.css")" rel="stylesheet" />
}

@section PageInlineScripts{
    <script src="@Url.VersionedContent("~/Scripts/Company/update.js")"></script>
    <script>
        var MemberGlobal = {
            //init: function () {
            //    this.eduHistories();
            //    this.workHistories();
            //    this.certificates();
            //},
            jobListTabFc: function () {
                JobListTab(1);
            },
            recruitedListTabFc: function () {
                RecruitedListTab(1);
            },
            mailBoxHistories: function () {
                CompanyMailBox(1);
            }
        };

        $("body").on("click", ".JobListTab", function () {
            if (!$(this).hasClass("loaded")) {
                MemberGlobal.jobListTabFc();
                $(this).addClass("loaded");
            }
        });

        $("body").on("click", ".RecruitedListTab", function () {
            if (!$(this).hasClass("loaded")) {
                MemberGlobal.recruitedListTabFc();
                $(this).addClass("loaded");
            }
        });

        $("body").on("click", ".MailBoxTab", function () {
            if (!$(this).hasClass("loaded")) {
                MemberGlobal.mailBoxHistories();
                $(this).addClass("loaded");
            }
        });

        function CompanyMailBox(pageIndex) {
            $("#MailBoxHistories").html("");
            showItemLoading("#MailBoxHistories");

            $("#CurrentMailBoxPageIdx").val(pageIndex);

            var frmData = $("#MailBoxFrm").serialize();

            var params = $.extend({}, doAjax_params_default);
            params['url'] = "/MyEmail/JobSeekerMailBox";
            params['requestType'] = "POST";
            params['data'] = frmData;
            params['dataType'] = "html";
            params['showloading'] = false;

            params['successCallbackFunction'] = function (data) {
                hideItemLoading("#MailBoxHistories");
                setTimeout(function () {
                    $("#MailBoxHistories").html(data);
                }, 300);

            };

            doAjax(params);
        }
        //    function JobListNextPage(currentPage) {
        //        function JobSeekerNoteSearchNext(pageNum) {
        //    $("#frmNote").find("input[name=CurrentPage]").val(pageNum);
        //    JobListTab();
        //}
        //    }
        function JobListTab(pageIndex) {
            $("#JobListTab").html("");
            showItemLoading("#JobListTab");

            $("#CurrentJobListTabPageIdx").val(pageIndex);

            var frmData = $("#JobListFrm").serialize();

            var params = $.extend({}, doAjax_params_default);
            params['url'] = "/Company/GetJobsByCompany";
            params['requestType'] = "POST";
            params['data'] = frmData;
            params['dataType'] = "html";
            params['showloading'] = false;

            params['successCallbackFunction'] = function (data) {
                hideItemLoading("#JobListTab");
                setTimeout(function () {
                    $("#JobListTab").html(data);
                }, 300);

            };

            doAjax(params);
        }

        function RecruitedListTab(pageIndex) {
            $("#RecruitedListTab").html("");
            showItemLoading("#RecruitedListTab");

            $("#frmRecruited").find("#CurrentPage").val(pageIndex);

            var frmData = $("#frmRecruited").serialize();

            var params = $.extend({}, doAjax_params_default);
            params['url'] = "/Candidate/Recruited";
            params['requestType'] = "POST";
            params['data'] = frmData;
            params['dataType'] = "html";
            params['showloading'] = false;

            params['successCallbackFunction'] = function (data) {
                hideItemLoading("#RecruitedListTab");
                setTimeout(function () {
                    $("#RecruitedListTab").html(data);
                }, 300);

            };

            doAjax(params);
        }

        $(function () {
            $(".file-upload-storage").change(function () {
                PreviewImageFromBrowseDialog(this);
            });
        });
        function AfterDelete() {
            JobListTab(1);
        }

        function mouseInHandler() {
            var id = $(this).data("id");
            $(".row-control-" + id).css("opacity", "1");
        };

        function mouseOutHandler() {
            var id = $(this).data("id");
            $(".row-control-" + id).css("opacity", "0");
        };

        $('.tbl-row-hover tr').hover(mouseInHandler, mouseOutHandler);
    </script>
}

